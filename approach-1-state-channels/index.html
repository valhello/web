<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Approach 1: State Channels - Valhello</title><meta name="description" content="How will the state channel approach help Valhello grow?"><meta name="robots" content="index, follow"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://valhello.app/approach-1-state-channels/"><meta property="og:title" content="Approach 1: State Channels"><meta property="og:image" content="https://valhello.app/media/posts/2/p02m63dp.jpg"><meta property="og:site_name" content="Valhello - the blockchain-assisted MUD game"><meta property="og:description" content="How will the state channel approach help Valhello grow?"><meta property="og:url" content="https://valhello.app/approach-1-state-channels/"><meta property="og:type" content="article"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@bitfalls"><meta name="twitter:title" content="Approach 1: State Channels"><meta name="twitter:description" content="How will the state channel approach help Valhello grow?"><meta name="twitter:image" content="https://valhello.app/media/posts/2/p02m63dp.jpg"><link rel="amphtml" href="https://valhello.app/amp/approach-1-state-channels/"><link type="application/atom+xml" rel="alternate" href="https://valhello.app/feed.xml"><link rel="shortcut icon" href="https://valhello.app/media/website/skull.png" type="image/x-icon"><link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin><link href="https://fonts.googleapis.com/css?family=Playfair+Display:400,700&amp;subset=latin-ext" rel="stylesheet"><style>h1,
                h2,
                h3,
                h4,
                h5,
                h6,
                blockquote,
                .logo,
                .footer__logo,
                .dropcap::first-letter,
                .search__input {
                    font-family: 'Playfair Display', serif
                }
        
                body,
                .btn,
                [type=button],
                [type=submit],
                button,       
                .navbar__menu,
                .footer {
                    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"
                }</style><link rel="stylesheet" href="https://valhello.app/assets/css/style.css?v=2860fc090005024237382909f0e2313b"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://valhello.app/approach-1-state-channels/"},"headline":"Approach 1: State Channels","datePublished":"2019-01-06T09:01","dateModified":"2019-01-06T11:20","image":{"@type":"ImageObject","url":"https://valhello.app/media/posts/2/p02m63dp.jpg","height":518,"width":1280},"description":"<p>The first approach to build Valhello will be with state channels. How will the state channel approach help Valhello grow? What are State channels and how do they work? Are they a viable scaling solution? Let's see.</p>\n","author":{"@type":"Person","name":"Bruno Škvorc"},"publisher":{"@type":"Organization","name":"Bruno Škvorc","logo":{"@type":"ImageObject","url":"https://valhello.app/media/website/skull.png","height":256,"width":256}}}</script><script src="https://valhello.app/assets/js/lazysizes.min.js?v=fcb7109aacc796048242935c33a7f9ab"></script><style></style></head><body><header class="header header--flat-no-hero" id="js-header"><div><a class="logo" href="https://valhello.app"><img src="https://valhello.app/media/website/skull.png" alt="Valhello"></a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu" aria-controls="navigation"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul id="js-navbar-menu" class="navbar__menu"><li><a href="https://valhello.app/valhello-world/">Intro</a></li><li><a href="https://valhello.app/faq/">FAQ</a></li><li><a href="https://github.com/valhello">Github</a></li></ul></nav></div></header><div class="main"><div class="wrapper"><article class="page post"><div class="post__inner"><header class="post__header"><h1 class="post__title">Approach 1: State Channels</h1><div class="post__meta"><a href="https://valhello.app/authors/bruno-skvorc/" class="post__meta-author invert" title="Bruno Škvorc"><img src="https://valhello.app/media/website/qXAJ_ItT_400x400-1.jpg" alt="Bruno Škvorc"> By Bruno Škvorc </a><time datetime="2019-01-06T09:01" class="page__item-date">January 6, 2019 </time><a href="https://valhello.app/tag/basics/" class="post__meta-category" title="basics">basics</a></div></header><div class="page__item-image page__item-image--wide"><figure class="page__item-image__wrap" style="padding-bottom: calc(518/1280 * 100%)"><img class="lazyload" src="https://valhello.app/media/posts/2/responsive/p02m63dp-xs.jpg" data-srcset="https://valhello.app/media/posts/2/responsive/p02m63dp-xs.jpg 300w ,https://valhello.app/media/posts/2/responsive/p02m63dp-sm.jpg 480w ,https://valhello.app/media/posts/2/responsive/p02m63dp-md.jpg 749w ,https://valhello.app/media/posts/2/responsive/p02m63dp-xl.jpg 1200w ,https://valhello.app/media/posts/2/responsive/p02m63dp-xxl.jpg 1600w ,https://valhello.app/media/posts/2/responsive/p02m63dp-xxxl.jpg 2560w" data-sizes="auto" height="518" width="1280" alt=""></figure></div><div class="post__entry"><p>The first approach to build Valhello will be with state channels. How will the state channel approach help Valhello grow? What are State channels and how do they work? Are they a viable scaling solution? Let's see.</p><p><em>Header image <a href="https://www.bbc.com/bitesize/articles/zw3qmp3">via BBC</a></em></p><p>The following content is partially extracted from <a href="https://bruno.id/valhello-ethereum-state-channels-for-games/">this post</a>.</p><h2>State Channels</h2><p>If you've been in Ethereum long enough, you probably remember the time <a href="https://bitfalls.com/2018/02/18/15-alternatives-cryptokitties-no-idea-existed/">CryptoKitties</a> slowed the whole network down because of pending transactions. Around that time, the idea of payment channels started to take more concrete shape across the various blockchain projects.</p><h3>Payment Channels</h3><p>A payment channel works like this: two parties deposit a stake into a multi-signature wallet, and then exchange messages about the state of that wallet until they're ready to close the wallet and each withdraw their share. So Alice and Bob may start out with A:1eth / B:0eth, and end with A:0.3eth / B:0.7eth. Between those two states (the opening and closing state), there may have been a thousand transactions - but all of them were free and instant because they were only communicated between the two parties. Once Alice and Bob are ready to broadcast their wallet states to the world, they send a transaction to the blockchain which contains the closing state, and to the outside world it looks like Alice just straight up sent Bob 0.7 eth. This is a payment channel because it channels payments, and we explained it with an illustrated example <a href="https://bitfalls.com/2018/04/15/lightning-network-work/">here</a> - highly recommended you read this.</p><p>The most notable examples of payment channels are Bitcoin's Lightning Network (which <a href="https://www.youtube.com/watch?v=yGrUOLsC9cw">cannot work</a> and is already <a href="https://twitter.com/abrkn/status/1078193601190989829">driving users away</a>) and Ethereum's Raiden Network which is just Eth's version of Lightning (Raiden is the god of lightning in Mortal Kombat).</p><p>Personally, I'm a much bigger fan of state channels.</p><h3>State Channels</h3><p>State channels are like payment channels, but for <em>state</em>. Technically, wallet balance is also state - the state refers to the current data of the blockchain, such that the balances of everyone are known. But while payment channels focus on tokens in particular (native like BTC or ETH or implementations like ERC20), state channels abstract that even further and consider not only token balances state, but also all other data points state.</p><p>So instead of exchanging messages about changes in wallet balance with another party, you exchange messages about data.</p><p>Example of a payment channel:</p><ul><li>Alice and Bob open a payment channel with 0.5 eth each (&lt;- transaction happens)</li><li>Alice sends Bob 0.1 eth</li><li>Alice sends Bob 0.1 eth</li><li>Alice sends Bob 0.1 eth</li><li>Bob refunds 0.25 eth</li><li>Alice and Bob close a payment channel with Alice having 0.45 and Bob having 0.55 eth. (&lt;- transaction happens)</li></ul><p>Example of a state channel:</p><ul><li>Alice buys a crypto kitty "AngryCat" on the open market for 0.5 eth (transaction outside state channel, on something like <a href="https://opensea.io/">Opensea</a>)</li><li>Bob buys a crypto kitty "BloatyCat" on the open market for 0.2 eth (transaction outside state channel, on something like <a href="https://opensea.io/">Opensea</a>)</li><li>Alice opens a channel with CryptoKitties, committing her AngryCat as a deposit along with 1 eth (&lt;- tx happens)</li><li>Bob opens a channel with CryptoKitties, committing his BloatyCat as a deposit along with 0.5 eth (&lt;- tx happens)</li><li>Alice puts AngryCat to breed for the breed price of 0.2 eth</li><li>Bob notices a breedable kitty AngryCat, and decides to accept the offer</li><li>Bob sends 0.2 eth to CryptoKitties for breeding BloatyCat with AngryCat</li><li>CryptoKitties sends 0.2 eth to Alice and creates a new cat - AngryFartCat - assigning it to Bob. This turns out to be a rare cat because angry farts are special.</li><li>Bob decides to put AngryFartCat up for breeding for the breed price of 0.5 eth.</li><li>A third user, Charlie, notices this cat and decides he wants in on the action. He has a cat from before: CombatCat, so he opens a channel with CryptoKitties and 0.5 eth (&lt;- tx happens)</li><li>Charlie breeds CombatCat with AngryFartCat, sending 0.5 eth to CK. CK mints a new cat: NerveGasCat, and assigns it to Charlie, sending 0.5 eth to Bob.</li><li>Bob decides he's had enough of the game for now and closes the channel. He ends up with a rare AngryFartCat and 0.8 eth. Bob profited. (&lt;- tx happens)</li><li>Charlie puts NerveGasCat up for breeding for 1 eth.</li><li>Alice would like to breed AngryCat with it. 1 eth out of her 1.2 eth is sent to CK. CK mints SaiyanCat and assigns it to Alice, sending her 1 eth to Charlie.</li><li>Alice and Charlie have now had enough, and exit the game by closing their channels (&lt;- tx happens)</li><li>Alice ends up with 0.2 eth but she also has SaiyanCat. She puts it up for sale on Opensea.io for 5 eth. If she sells it, she's turned a nice profit from the starting 1 eth.</li><li>Charlie ends up with 1 eth (a profit of 0.5 eth) and NerveGasCat. He's happy with the gain, but still puts it up for sale on Opensea.io for 5 eth.</li></ul><p>As you can see, the gameplay itself can get pretty complex - especially as we introduce more players - but the number of transactions when players are <em>in</em> the game (i.e. have state channels open) remains the same. We still max out at 2 transactions per player - one to open the channel, and one to close. Granted, if Alice wanted to breed for 1 eth and didn't have enough eth in her balance, she would have to either earn it in the game by breeding / selling / etc. or she would have had to top up her account. This would have required another transaction (a top-up is actually a simultaneous open / close channel transaction).</p><p>Now if we apply this to a truly multi-player game with consequences and more interactivity, we can stretch out imagination a bit and see how it might apply to a MUD. Read on below.</p><p>To find out more about state channels, see:</p><ul><li style="list-style-type: none;"><ul><li><a href="http://www.jeffcoleman.ca/state-channels/">http://www.jeffcoleman.ca/state-channels/</a></li><li></li></ul></li></ul><a href="https://medium.com/l4-media/making-sense-of-ethereums-layer-2-scaling-solutions-state-channels-plasma-and-truebit-22cb40dcc2f4">https://medium.com/l4-media/making-sense-of-ethereums-layer-2-scaling-solutions-state-channels-plasma-and-truebit-22cb40dcc2f4</a><ul><li><a href="http://ledgerjournal.org/ojs/index.php/ledger/article/download/15/64">http://ledgerjournal.org/ojs/index.php/ledger/article/download/15/64</a></li><li><a href="https://gist.github.com/anonymous/ecda6a24d0f32522a691fd21d75c5e6">https://gist.github.com/anonymous/ecda6a24d0f32522a691fd21d75c5e6</a></li><li><a href="https://www.counterfactual.com/technology/">https://www.counterfactual.com/technology/</a></li></ul><h2>Implementation</h2><h3>Account Creation</h3><p>To create an account, a user interacts with the game's smart contract by sending in 0.15 eth. 0.05 eth used for funding further development (better than an ICO <code>¯\_(ツ)_/¯</code>), while 0.1 eth is locked up as that player's deposit. The created character thus enters Asgard (the lobby area), where everything begins.</p><h3>World Shards are State Channels</h3><p>Each world zone is a state channel, including Asgard. So entering Asgard adds a player to the Asgard state channel. Whenever a player exits a shard, they get their deposit back. Whenever a player enters a shard, they need to put the deposit down again. The deposit is always 0.1 eth, and the initial 0.05 eth character creation fee is only paid once per character, but every time for a new character. This deposit is a guarantee of good behavior, and is refunded once the player character exits ("Summon a Valkyrie") unless the exit was an ejection triggered by another player (i.e. an invalid transaction was detected and not rectified in a given time frame).</p><p>During interaction in a shard, it is assumed all players are making only valid moves. If, however, a player makes invalid moves IRT the game state, others who detected these moves can trigger a reporting procedure which will send a transaction to the public blockchain for the initiation of the dispute resolution process. In other words, you can rat someone out and unless they start behaving they get kicked out of the universe and their deposit is split in half: half is burned, and half is given to the reporter and those confirming the report.</p><p>Players transition between worlds (zones) through the Bifrost portal by exiting a previous channel, if in any, and entering a new channel. Entering and exiting a zone means sending a transaction, but keeps the game worlds isolated and small, allowing for addition of zones, tweaks to rules, user-contributed zones, and more.</p><h3>Rest and exit</h3><p>As long as players remain in the game, others can initiate combat with them, steal from them, interact with them. If the player remains inactive (no response given) for more than 24 hours, their state channel automatically closes. A player can close their channel manually, too, to exit the game and pause their character (the Summon a Valkyrie operation). This has the added effect of withdrawing the player character to a user's wallet, which lets them trade the character on an NFT marketplace (the player characters are <a href="https://bitfalls.com/nft">NFTs</a>).</p><h3>UX</h3><p>All this talk about transactions makes for a poor user experience. The average user does not want to think about transactions, gas costs, confirmation times, etc. The way we get around this is as follows:</p><ul><li>the game will use <a href="https://our.status.im/tag/nimbus">Nimbus</a> as a back end, which can handle peer to peer connections and key management. In effect, the game client is a wallet which can auto-sign transactions or, for the more paranoid, request a password for every transaction (depending on whether or not a keystore file was encrypted). This means that the user starts playing by downloading the game client (weird to call it that since there's no <em>server</em>, but okay), seeding it with a bit of eth, and the client takes over, occasionally asking for a password.</li><li>each interaction with a shard is happening on a state channel, which makes it possible to interact with other players and the world through commands like <code>LOOK at @swader</code>or <code>PUNCH @swader</code> or <code>GIVE #mjolnir to @swader</code>. These interactions are signed messages aggregating on the clients running that particular <em>shard</em> of the universe, of which there will always be at least 2: the software running over in <a href="https://bitfalls.com/">Bitfalls HQ</a>, and the player's computer.</li></ul><p>Therefore, think of the game client like a stripped down version of <a href="https://bitfalls.com/2018/02/12/explaining-ethereum-tools-geth-mist/">Mist</a> which has the ability to execute custom pre-defined transactions. The client itself will contain all the game logic.</p><h3>State growth</h3><p>To achieve a feeling of real time interaction, the clients that communicate are constantly exchanging messages that basically say "no action taken". This happens roughly once per second (throttled, so powerful computers don't become too fast players). This allows a player to issue a command at any time, and it'll seem real time. This also means the state of the channel grows rapidly and constantly.</p><p>Because it's in everyone's best interest to keep the game client light-weight, the plan is to occasionally purge the shard data though how often and <em>how</em> exactly is still up in the air and will be decided when we see how fast the clients are filling up hard drives.</p><h2>What next?</h2><p>Wait for the code or help us write it. The <a href="https://github.com/valhello">Valhello org on Github</a> is the one to keep an eye on, or get in touch <a href="https://twitter.com/bitfalls">on Twitter</a>.</p></div><footer><div class="post__updated">Updated: <time datetime="2019-01-06T11:20">January 6, 2019</time></div><ul class="post__tag"><li><a href="https://valhello.app/tag/basics/" title="basics" class="invert">basics</a></li><li><a href="https://valhello.app/tag/state-channels/" title="state-channels" class="invert">state-channels</a></li></ul><div class="post__share"><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fvalhello.app%2Fapproach-1-state-channels%2F" class="js-share facebook" title="Share with Facebook" rel="nofollow"><svg><use xlink:href="https://valhello.app/assets/svg/svg-map.svg#facebook"/></svg> </a><a href="https://twitter.com/share?url=https%3A%2F%2Fvalhello.app%2Fapproach-1-state-channels%2F&amp;via=GetPublii&amp;text=Approach%201%3A%20State%20Channels" class="js-share twitter" title="Share with Twitter" rel="nofollow"><svg><use xlink:href="https://valhello.app/assets/svg/svg-map.svg#twitter"/></svg> </a><a href="http://www.linkedin.com/shareArticle?url=https%3A%2F%2Fvalhello.app%2Fapproach-1-state-channels%2F&amp;title=Approach%201%3A%20State%20Channels" class="js-share linkedin" title="Share with LinkedIn" rel="nofollow"><svg><use xlink:href="https://valhello.app/assets/svg/svg-map.svg#linkedin"/></svg></a></div><div class="post__bio"><img class="lazyload" data-src="https://valhello.app/media/website/qXAJ_ItT_400x400-1.jpg" alt="Bruno Škvorc"><div><h3 class="h5"><a href="https://valhello.app/authors/bruno-skvorc/" title="Bruno Škvorc" class="invert">Bruno Škvorc</a></h3><p>Bruno works as a technical writer and blockchain dev on the Nimbus team at Status.im. Find out more at https://bruno.id</p></div></div><nav class="post__nav" id="js-post__nav"><div class="post__nav__prev"><a href="https://valhello.app/valhello-world/" rel="prev" class="post__nav__link"><img class="lazyload" src="https://valhello.app/media/posts/1/responsive/lostvikingsi_em_008_117327-xs.jpg" data-srcset="https://valhello.app/media/posts/1/responsive/lostvikingsi_em_008_117327-xs.jpg" data-expand="300" alt=""><div class="post__nav__text">Prev:<h5 class="invert">Valhello World</h5></div></a></div><div class="post__nav__next"><a href="https://valhello.app/approach-2-loomx/" rel="next" class="post__nav__link"><div class="post__nav__text">Next:<h5 class="invert">Approach 2: LoomX</h5></div><img class="lazyload" src="https://valhello.app/media/posts/3/responsive/elvira-akchurina-viking_crop-xs.jpg" data-srcset="https://valhello.app/media/posts/3/responsive/elvira-akchurina-viking_crop-xs.jpg" data-expand="300" alt=""></a></div></nav></footer></div></article><div class="page post__related"><h3 class="h4">Similar posts:</h3><div class="post__related__wrap"><figure><a href="https://valhello.app/valhello-world/"><img class="lazyload" src="https://valhello.app/media/posts/1/responsive/lostvikingsi_em_008_117327-xs.jpg" data-srcset="https://valhello.app/media/posts/1/responsive/lostvikingsi_em_008_117327-xs.jpg" data-expand="300" alt=""></a><figcaption><h4 class="h6"><a href="https://valhello.app/valhello-world/" class="invert">Valhello World</a></h4></figcaption></figure><figure><a href="https://valhello.app/approach-2-loomx/"><img class="lazyload" src="https://valhello.app/media/posts/3/responsive/elvira-akchurina-viking_crop-xs.jpg" data-srcset="https://valhello.app/media/posts/3/responsive/elvira-akchurina-viking_crop-xs.jpg" data-expand="300" alt=""></a><figcaption><h4 class="h6"><a href="https://valhello.app/approach-2-loomx/" class="invert">Approach 2: LoomX</a></h4></figcaption></figure><figure><a href="https://valhello.app/approach-3-substrate/"><img class="lazyload" src="https://valhello.app/media/posts/4/responsive/23DFA35200000578-0-A_new_study_shows_the_importance_of_women_in_the_colonisation_of-a-4_1418032940998-xs.jpg" data-srcset="https://valhello.app/media/posts/4/responsive/23DFA35200000578-0-A_new_study_shows_the_importance_of_women_in_the_colonisation_of-a-4_1418032940998-xs.jpg" data-expand="300" alt=""></a><figcaption><h4 class="h6"><a href="https://valhello.app/approach-3-substrate/" class="invert">Approach 3: Substrate</a></h4></figcaption></figure></div></div></div></div><footer class="footer"><div class="wrapper"><a class="footer__logo" href="https://valhello.app"><img src="https://valhello.app/media/website/skull.png" alt="Valhello"></a><div class="footer__copy">&copy; 2019 Bruno Skvorc and Bitfalls d.o.o.</div><div class="footer__social"><a href="@bitfalls" aria-label="Twitter" target="_blank"><svg><use xlink:href="https://valhello.app/assets/svg/svg-map.svg#twitter"/></svg></a></div></div><button class="footer__bttop js-footer__bttop"><svg><title>[MISSING TRANSLATION]</title><use xlink:href="https://valhello.app/assets/svg/svg-map.svg#toparrow"/></svg></button></footer><script defer="defer" src="https://valhello.app/assets/js/scripts.min.js?v=e742b9a5e76b4ccaa6e2fc18a256f793"></script><script defer="defer">var lazyFeaturedImage = function lazyFeaturedImage() {
         var lazyFeaturedImageImages = document.querySelectorAll('.hero__image-img');

         for (var i = 0; i < lazyFeaturedImageImages.length; i++) {
            var lazyFeaturedImageImg = lazyFeaturedImageImages[i];

            lazyFeaturedImageImg.addEventListener('lazyloaded', function (e) {
               var featuredImage = e.target.parentNode;
               featuredImage.classList.add('hero__image--overlay');
            });
         }
      }
      lazyFeaturedImage();</script></body></html>